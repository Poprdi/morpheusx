# cargo-deny configuration for MorpheusX
# https://embarkstudios.github.io/cargo-deny/
#
# Run with: cargo deny check
# Used by: .github/workflows/audit.yml

# ═══════════════════════════════════════════════════════════════════════════════
# ADVISORIES: Check for known security vulnerabilities
# ═══════════════════════════════════════════════════════════════════════════════
[advisories]
db-path = "~/.cargo/advisory-db"
db-urls = ["https://github.com/rustsec/advisory-db"]

# How to handle advisories
vulnerability = "warn"      # Known vulnerabilities
unmaintained = "warn"       # Unmaintained crates
yanked = "warn"             # Yanked versions
notice = "warn"             # General notices

# Ignore specific advisories (with justification)
ignore = [
    # Example: "RUSTSEC-2020-0001", # reason: not exploitable in our context
]

# ═══════════════════════════════════════════════════════════════════════════════
# LICENSES: Ensure all dependencies have acceptable licenses
# ═══════════════════════════════════════════════════════════════════════════════
[licenses]
# Confidence threshold for license detection
confidence-threshold = 0.8

# Allow these licenses (common permissive licenses)
allow = [
    "MIT",
    "Apache-2.0",
    "Apache-2.0 WITH LLVM-exception",
    "BSD-2-Clause",
    "BSD-3-Clause",
    "ISC",
    "Zlib",
    "MPL-2.0",
    "Unicode-3.0",
    "Unicode-DFS-2016",
    "Unlicense",
    "CC0-1.0",
    "0BSD",
]

# Crates with non-standard licensing that we've reviewed
[[licenses.clarify]]
name = "ring"
expression = "ISC AND MIT AND OpenSSL"
license-files = [{ path = "LICENSE", hash = 0xbd0eed23 }]

# ═══════════════════════════════════════════════════════════════════════════════
# BANS: Prevent unwanted dependencies
# ═══════════════════════════════════════════════════════════════════════════════
[bans]
# Warn when multiple versions of the same crate are used
multiple-versions = "warn"

# Warn about wildcard dependencies
wildcards = "warn"

# Allow specific duplicates (with justification)
# skip = [
#     { name = "example", version = "1.0" }, # reason: transitive dep conflict
# ]

# Deny specific crates entirely
# deny = [
#     { name = "openssl" }, # reason: prefer rustls
# ]

# ═══════════════════════════════════════════════════════════════════════════════
# SOURCES: Restrict where dependencies can come from
# ═══════════════════════════════════════════════════════════════════════════════
[sources]
# Deny unknown registries
unknown-registry = "deny"

# Warn about git dependencies (prefer crates.io)
unknown-git = "warn"

# Only allow crates.io
allow-registry = ["https://github.com/rust-lang/crates.io-index"]

# Allow specific git repos if needed
# allow-git = []
